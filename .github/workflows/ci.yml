# This is a basic workflow to help you get started with Actions

name: CI

# Controls when the workflow will run
on:
  # Triggers the workflow on push or pull request events but only for the "main" branch
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:
jobs:  
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Check out the repository
        uses: actions/checkout@v2

      - name: Set up JDK
        uses: actions/setup-java@v2
        with:
          java-version: '17'         # Set the desired Java version
          distribution: 'temurin'    # Specify the Java distribution

      - name: Build with Maven
        run: mvn clean install

  test:
    runs-on: ubuntu-latest
    needs: build
    steps:
      - name: Check out the repository
        uses: actions/checkout@v2

      - name: Set up JDK
        uses: actions/setup-java@v2
        with:
          java-version: '17'         # Set the desired Java version
          distribution: 'temurin'    # Specify the Java distribution

      - name: Run tests
        run: mvn test 
 
  code_quality:
   runs-on: ubuntu-latest
   needs: test
   steps:
     - name: Check out the repository
       uses: actions/checkout@v2

     - name: Set up JDK
       uses: actions/setup-java@v2
       with:
         java-version: '17'
         distribution: 'temurin'

     - name: Run code quality analysis
       run: mvn sonar:sonar -Dsonar.projectKey=cms -Dsonar.host.url=http://localhost:9093 -Dsonar.login=${{ secrets.SONAR_TOKEN }} -X
    

